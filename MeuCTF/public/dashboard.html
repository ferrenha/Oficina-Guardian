<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; max-width: 760px; margin: 32px auto; }
    .row { display:flex; gap: 10px; align-items:center; }
    .card { border:1px solid #ddd; padding:16px; margin-top:16px; }
    .hint { color:#666; font-size: 13px; }
    img.avatar { max-width:120px; border:1px solid #ccc; padding:4px; }
  </style>
  <script>
  const TOKEN_KEY = 'ctf_token';
  function token() {
    const t = localStorage.getItem(TOKEN_KEY);
    if (!t) location.href = '/login.html';
    return t;
  }

  async function loadDash() {
    const res = await fetch('/api/users/me', { headers: { Authorization: 'Bearer ' + token() }});
    if (!res.ok) { localStorage.removeItem(TOKEN_KEY); return location.href = '/login.html'; }
    const me = await res.json();

    document.getElementById('username').textContent = me.username;

    const img = document.getElementById('avatar');
    img.onerror = () => { img.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect width="100%" height="100%" fill="%23eee"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="14">sem avatar</text></svg>'; };
    img.src = `/avatars/user-${me.id}.png?t=${Date.now()}`;
  }

  function gotoAdmin(){ window.location.href = '/admin.html'; }
  function logout(){ localStorage.removeItem(TOKEN_KEY); window.location.href = '/login.html'; }
  document.addEventListener('DOMContentLoaded', loadDash);
  </script>
  </head>
<body>
  <h1>Conta</h1>
  <div class="card">
    <div><strong>Nome do usuário:</strong> <span id="username">Carregando...</span></div>
    <div class="row" style="margin-top:10px;">
      <button onclick="gotoAdmin()">Mudar Avatar</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="card">
    <h3>Avatar</h3>
    <img id="avatar" class="avatar" alt="avatar" />
    <p class="hint">Para fazer envios você precisa ser admin</p>
  </div>
</body>
</html>
